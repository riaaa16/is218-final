<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width-device-width", intial-scale="1">
    <title>IS218 Final</title>
    <style>
        legend {
            margin: auto;
            padding 0 2em;
        }
    </style>
</head>

<body>
    <form>
        <fieldset>
            <legend>Basic Information</legend>

            <label for="sender">Your Name</label>
            <input type="text" id="sender" maxlength="50" required>

            <label for="recipient">Who are you attacking?</label>
            <input type="text" id="recipient" maxlength="50" autocomplete="off" required>

            <div>
                <h3>Choose your team</h3>

                <input type="radio" id="Cats" value="cat" name="team" required>
                <label for="Cats">Cats</label>

                <input type="radio" id="Dogs" value="dog" name="team">
                <label for="Dogs">Dogs</label>

                <label for="link">Enter the link to your attack:</label>
                <input type="url" name="link" id="link" placeholder="https://example.com" autocomplete="off" required>
            </div>
        </fieldset>

        <fieldset>
            <legend>Art Information</legend>
            <div>
                <h3>Size</h3>
                <input type="radio" id="simple" value="0.5" name="size" autocomplete="off" required>
                <label for="simple">Simple</label>

                <input type="radio" id="portrait" value="1" name="size" autocomplete="off">
                <label for="portrait">Portrait | Bust</label>

                <input type="radio" id="half" value="1.5" name="size" autocomplete="off">
                <label for="half">Half-body</label>

                <input type="radio" id="full" value="2" name="size" autocomplete="off">
                <label for="full">Full-body</label>
            </div>
            <div>
                <h3>Finish</h3>
                <input type="radio" id="sketch" value="5" name="finish" autocomplete="off" required>
                <label for="sketch">Rough Sketch</label>

                <input type="radio" id="lined" value="10" name="finish" autocomplete="off">
                <label for="lined">Cleaned | Lined | Lineless</label>
            </div>
            <div>
                <h3>Color</h3>
                <input type="radio" id="noColor" value="0" name="color" autocomplete="off" required>
                <label for="noColor">Uncolored</label>

                <input type="radio" id="roughColor" value="5" name="color" autocomplete="off">
                <label for="roughColor">Rough Color</label>

                <input type="radio" id="paint" value="10" name="color" autocomplete="off">
                <label for="paint">Clean color | Painted</label>
            </div>
            <div>
                <h3>Shading</h3>
                <input type="radio" id="noShade" value="0" name="shading" autocomplete="off" required>
                <label for="noShade">Unshaded</label>

                <input type="radio" id="minShade" value="5" name="shading" autocomplete="off">
                <label for="minShade">Minimal Shading</label>

                <input type="radio" id="fullShade" value="10" name="shading" autocomplete="off">
                <label for="fullShade">Full Shading</label>
            </div>
            <div>
                <h3>Background</h3>
                <input type="radio" id="noBG" value="0" name="bg" autocomplete="off" required>
                <label for="nogBG">No Background | Minimal | Photo</label>

                <input type="radio" id="pattern" value="5" name="bg" autocomplete="off">
                <label for="pattern">Pattern | Abstract</label>

                <input type="radio" id="props" value="10" name="bg" autocomplete="off">
                <label for="props">Props | Scene Elements | Design Layout</label>

                <input type="radio" id="fullBG" value="20" name="bg" autocomplete="off">
                <label for="fullBG">Full Scene</label>
            </div>
            <div>
                <h3>Characters</h3>
                <label for="num_chars">Enter the number of characters in your drawing here:</label>
                <input type="number" id="num_chars" name="num_chars" min="1" max="100" autocomplete="off" required>
            </div>
        </fieldset>
        <!--SUBMIT BUTTON-->
        <input type="submit" value="Submit">
    </form>

    <div id="result"></div>

    <!--JAVASCRIPT-->
    <script>
        // JavaScript for form validation and score calculation
        document.addEventListener("DOMContentLoaded", () => {
            const form = document.querySelector("form");

            form.addEventListener("submit", (event) => {
                event.preventDefault(); // Prevent default form submission

                console.log("Checking form submission.");
                // Check that all required fields were filled out
                if (!form.checkValidity()) {
                    // Log invalid response to console if otherwise
                    console.log(form.reportValidity());
                }
                console.log("All required fields were filled.");

                console.log("Retrieving form input.")
                // Get form data
                const sender = form.sender.value.trim();
                const recipient = form.recipient.value.trim();
                const team = form.team.value;
                const link = form.link.value.trim();
                const finish = parseFloat(form.finish.value);
                const color = parseFloat(form.color.value);
                const shading = parseFloat(form.shading.value);
                const bg = parseFloat(form.bg.value);
                const size = parseFloat(form.size.value);
                const num_chars = parseInt(form.num_chars.value, 10);

                // Call the calculateScore function with the retrieved values
                calculateScore(sender, recipient, team, link, finish, color, shading, bg, size, num_chars);

                console.log("Resetting form inputs.");
                form.reset();
            });
        });

        async function calculateScore(sender, recipient, team, link, finish, color, shading, bg, size, num_chars) {
            // Get result
            const result = document.getElementById('result');

            try {
                console.log("Sending form input to FastAPI.");

                const response = await fetch('/score', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        sender: sender,
                        recipient: recipient,
                        team: team,
                        link: link,
                        finish: finish,
                        color: color,
                        shading: shading,
                        bg: bg,
                        size: size,
                        num_chars: num_chars
                    })
                });

                const data = await response.json();

                console.log("Response Status:", response.status);
                console.log("Calculated Score:", data.score);

                if (response.ok) {
                    console.log("Response successful.");
                    result.innerText = `${sender} attacked ${recipient} for ${data.score} points!`;
                } else {
                    console.error("Response failed.");
                    result.innerText = `Error: ${data.detail || 'Something went wrong.'}`;
                }

            } catch (error) {
                console.error('Fetch error:', error);
                result.innerText = `Error: ${error.message}`;
            }

        }
    </script>

</body>

</html>